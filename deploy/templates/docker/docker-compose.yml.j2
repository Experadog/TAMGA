version: '3.10'


networks:
  default: {}
  dev-tamga:
    external: true


x-shared-environment: &shared-environment {}

x-base-image: &base-image
  restart: unless-stopped
  environment:
    <<: *shared-environment
  networks:
    default: {}
    dev-tamga: {}
  logging:
    options:
      max-size: "10m"
      max-file: "3"


services:
  web: &web
    <<: *base-image
    hostname: web
    container_name: web
    image: "{{ lookup('ansible.builtin.env', 'CI_REGISTRY_IMAGE') }}:{{ lookup('ansible.builtin.env', 'CI_COMMIT_REF_SLUG') }}-{{ lookup('ansible.builtin.env', 'CI_COMMIT_SHA') }}"
    healthcheck:
      test: wget --no-verbose --tries=1 --spider http://localhost:3000 || exit 1
      interval: 5s
      timeout: 3s
      retries: 3
    ports:
      - 3000:3000
