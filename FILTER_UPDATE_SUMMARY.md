# Обновление компонента HorizontalFilters - Финальная версия

## Внесенные изменения

### 1. Система временных фильтров
- ✅ **Временные фильтры (`tempFilters`)** - изменения в селектах сохраняются во временном состоянии
- ✅ **Кнопка "Применить"** - применяет временные фильтры к основному состоянию и URL
- ✅ **Синхронизация** - при изменении URL обновляются и основные, и временные фильтры

### 2. Динамическое управление видимостью фильтров
- ✅ **Состояние видимости (`filterVisibility`)** - управляет отображением каждого типа фильтра
- ✅ **Панель настроек** - показывает только те фильтры, которые есть в directories
- ✅ **Автоматическое скрытие** - при снятии чекбокса фильтр сразу исчезает и очищается

### 3. Логика применения фильтров
- **Селекты**: Изменения сохраняются во временном состоянии, применяются только по кнопке "Применить"
- **Чипы**: Удаление применяется мгновенно через функцию `removeFilter()`
- **Алфавит**: Применяется мгновенно (как и было ранее)
- **Очистка**: Очищает и основные, и временные фильтры сразу

### 4. Новые функции

#### `applyFilters()`
```javascript
const applyFilters = () => {
    setFilters(tempFilters);
    updateURL(tempFilters);
};
```

#### `removeFilter(name, selectedValues)`
```javascript
const removeFilter = (name, selectedValues) => {
    const newFilters = { ...filters, [name]: selectedValues, offset: '0' };
    const newTempFilters = { ...tempFilters, [name]: selectedValues, offset: '0' };
    setFilters(newFilters);
    setTempFilters(newTempFilters);
    updateURL(newFilters);
};
```

#### `toggleFilterVisibility(filterName, isVisible)`
```javascript
const toggleFilterVisibility = (filterName, isVisible) => {
    setFilterVisibility(prev => ({
        ...prev,
        [filterName]: isVisible
    }));
    
    // Если фильтр скрывается, очищаем его значения
    if (!isVisible) {
        // ...логика очистки
    }
};
```

### 5. Структура состояний

#### Основные фильтры (`filters`)
- Применяются к URL и результатам поиска
- Отображаются в чипах
- Обновляются при применении временных фильтров или удалении через чипы

#### Временные фильтры (`tempFilters`)
- Используются в селектах
- Накапливают изменения до применения
- Синхронизируются с основными фильтрами при загрузке

#### Видимость фильтров (`filterVisibility`)
- Управляет отображением каждого типа фильтра
- При отключении автоматически очищает соответствующие значения

### 6. Панель настроек с SimpleCustomSelect
- **Единый интерфейс**: Использует тот же SimpleCustomSelect, что и основные фильтры
- **Мультиселект**: Позволяет выбирать несколько фильтров одновременно
- **Автоматическое наполнение**: Показывает только те фильтры, которые имеют данные в directories
- **Информативность**: Отображает количество выбранных фильтров и общее количество доступных
- **Мгновенное применение**: Изменения применяются сразу при выборе/снятии выбора

#### Структура данных для настроек
```javascript
const getAvailableFilters = () => {
    const filters = [];
    
    // Проверяем наличие данных и добавляем доступные фильтры
    if (directories.regions.length > 0) {
        filters.push({ id: 'regions', name: 'Регионы', category: 'geographic' });
    }
    // ... и так далее для всех типов фильтров
    
    return filters;
};
```

#### Функция управления видимостью
```javascript
const handleFilterVisibilityChange = (selectedFilters) => {
    // Устанавливаем видимость выбранных фильтров
    // Автоматически очищаем значения скрытых фильтров
};
```

### 7. Пользовательский опыт

1. **Выбор фильтров**: Пользователь выбирает значения в селектах
2. **Накопление изменений**: Изменения накапливаются во временном состоянии  
3. **Применение**: Нажатие "Применить" активирует все выбранные фильтры
4. **Быстрое удаление**: Клик по чипу мгновенно удаляет фильтр
5. **Настройка интерфейса**: В настройках можно скрыть ненужные типы фильтров

### 8. Технические особенности
- Все селекты (включая настройки) используют единый компонент `SimpleCustomSelect`
- Основные фильтры используют `tempFilters` для selectedValues
- Чипы используют `filters` для отображения и `removeFilter` для удаления
- Настройки автоматически формируют список доступных фильтров на основе directories
- Видимость фильтров контролируется через `filterVisibility` состояние
- При скрытии фильтра через настройки его значения автоматически очищаются

### 9. Панель настроек - подробности
- **Единообразный интерфейс**: Использует тот же `SimpleCustomSelect`, что и основные фильтры
- **Адаптивное содержимое**: Автоматически показывает только фильтры с данными
- **Мультиселект**: Можно выбрать несколько фильтров одновременно
- **Информационная панель**: Показывает статистику выбранных фильтров
- **Автоочистка**: При снятии выбора значения фильтра автоматически очищаются

## Использование

1. **Выбор фильтров** - выбирайте значения в селектах (не применяются сразу)
2. **Применение** - нажмите "Применить" для активации всех выбранных фильтров
3. **Быстрое удаление** - кликните × на чипе для мгновенного удаления фильтра
4. **Настройка интерфейса** - используйте панель настроек для скрытия ненужных фильтров
5. **Управление видимостью** - кнопка "Открыть/Скрыть фильтры" переключает основную панель

Компонент теперь обеспечивает оптимальный пользовательский опыт с возможностью накопления изменений и гибкой настройкой интерфейса.
